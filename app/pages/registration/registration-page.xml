<Page xmlns="http://schemas.nativescript.org/tns.xsd" navigatingTo="onNavigatingTo" class="bg-gray-100">
    <ActionBar title="Create Account" class="bg-blue-500 text-white">
        <NavigationButton text="Back" android.systemIcon="ic_menu_back" tap="onBackTap" />
    </ActionBar>

    <ScrollView>
        <StackLayout class="p-4 pb-20">
            <StackLayout class="bg-white p-4 rounded-lg shadow-lg mb-20">
                <!-- User Type Selection -->
                <Label text="Register as:" class="text-gray-600 mb-2" />
                <SegmentedBar selectedIndex="{{ userTypeIndex }}" class="mb-4">
                    <SegmentedBar.items>
                        <SegmentedBarItem title="Pharmacy" />
                        <SegmentedBarItem title="Courier" />
                    </SegmentedBar.items>
                </SegmentedBar>

                <!-- Common Fields -->
                <Label text="Email" class="text-gray-600" />
                <TextField text="{{ email }}" 
                          hint="Enter email" 
                          keyboardType="email" 
                          autocorrect="false"
                          autocapitalizationType="none"
                          class="mb-4 p-3 border rounded" />
                
                <Label text="Password" class="text-gray-600" />
                <TextField text="{{ password }}" 
                          hint="Enter password" 
                          secure="true" 
                          class="mb-4 p-3 border rounded" />
                
                <Label text="Phone Number" class="text-gray-600" />
                <TextField text="{{ phoneNumber }}"
                          hint="Enter phone number"
                          keyboardType="phone"
                          class="mb-4 p-3 border rounded" />

                <!-- Location Selection (Required for all users) -->
                <Label text="Country" class="text-gray-600" />
                <ListPicker items="{{ countryNames }}"
                           selectedIndex="{{ selectedCountryIndex }}"
                           class="mb-4 p-3 border rounded" />

                <Label text="City" class="text-gray-600" />
                <ListPicker items="{{ cityNames }}"
                           selectedIndex="{{ selectedCityIndex }}"
                           class="mb-4 p-3 border rounded" />

                <!-- Mobile Money Provider Selection -->
                <Label text="Mobile Money Provider" class="text-gray-600" />
                <Label text="For wallet top-ups and payouts" class="text-gray-400 text-sm mb-1" />
                <ListPicker items="{{ providerNames }}"
                           selectedIndex="{{ selectedProviderIndex }}"
                           class="mb-4 p-3 border rounded" />

                <!-- Role-specific Fields -->
                <StackLayout visibility="{{ isPharmacy ? 'visible' : 'collapsed' }}">
                    <Label text="Pharmacy Name" class="text-gray-600" />
                    <TextField text="{{ pharmacyName }}"
                              hint="Enter pharmacy name"
                              class="mb-4 p-3 border rounded" />

                    <Label text="License Number" class="text-gray-600" />
                    <TextField text="{{ licenseNumber }}"
                              hint="Enter license number"
                              class="mb-4 p-3 border rounded" />

                    <Label text="Address / Landmark" class="text-gray-600" />
                    <TextField text="{{ address }}"
                              hint="Enter address or nearby landmark"
                              class="mb-4 p-3 border rounded" />

                    <!-- GPS Location Capture (Alternative to address) -->
                    <Label text="GPS Location (Recommended)" class="text-gray-600 font-bold" />
                    <Label text="Capture your GPS location OR enter a detailed address above. GPS helps couriers find you more easily."
                           class="text-gray-500 text-sm mb-2" textWrap="true" />

                    <Button text="{{ captureButtonText }}"
                            tap="{{ onCaptureLocation }}"
                            isEnabled="{{ !isCapturingLocation }}"
                            class="bg-blue-500 text-white p-3 rounded-lg mb-2" />

                    <!-- Show captured coordinates -->
                    <StackLayout visibility="{{ locationCaptured ? 'visible' : 'collapsed' }}" class="bg-green-100 p-3 rounded-lg mb-4">
                        <Label text="Location captured successfully!" class="text-green-700 font-bold" />
                        <Label text="{{ coordinatesDisplay }}" class="text-green-600 text-sm" />
                    </StackLayout>

                </StackLayout>

                <StackLayout visibility="{{ !isPharmacy ? 'visible' : 'collapsed' }}">
                    <Label text="Vehicle Type" class="text-gray-600" />
                    <ListPicker items="{{ vehicleTypes }}" 
                               selectedIndex="{{ selectedVehicleIndex }}" 
                               class="mb-4 p-3 border rounded" />
                </StackLayout>

                <!-- Submit Button -->
                <Button text="Create Account"
                        tap="{{ onSubmit }}"
                        class="bg-green-500 text-white p-3 rounded-lg mt-4" />

                <!-- Error Message -->
                <Label text="{{ errorMessage }}"
                       class="text-red-500 text-center mt-2"
                       textWrap="true"
                       visibility="{{ errorMessage ? 'visible' : 'collapsed' }}" />
            </StackLayout>
        </StackLayout>
    </ScrollView>
</Page>