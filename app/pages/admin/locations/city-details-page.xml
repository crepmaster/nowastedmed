<Page xmlns="http://schemas.nativescript.org/tns.xsd"
      navigatingTo="onNavigatingTo"
      class="bg-gray-100">

    <ActionBar title="{{ cityName }}" class="bg-purple-600 text-white">
        <NavigationButton text="Back" android.systemIcon="ic_menu_back" tap="onBackTap" />
    </ActionBar>

    <GridLayout rows="auto, auto, *">
        <!-- City Info Card -->
        <StackLayout row="0" class="bg-white m-2 p-4 rounded-lg shadow">
            <Label text="{{ cityName }}" class="text-xl font-bold" />
            <Label text="{{ countryName }} ({{ countryCode }})" class="text-gray-600" />
            <GridLayout columns="*, *" rows="auto" class="mt-3">
                <StackLayout col="0">
                    <Label text="{{ isActive ? 'Active' : 'Inactive' }}"
                           class="{{ isActive ? 'text-green-600' : 'text-red-600' }} font-bold" />
                </StackLayout>
                <StackLayout col="1">
                    <Label text="{{ isCapital ? 'Capital City' : '' }}" class="text-blue-600" />
                </StackLayout>
            </GridLayout>
        </StackLayout>

        <!-- Actions -->
        <GridLayout row="1" columns="*, *" class="m-2">
            <Button col="0"
                    text="+ Add Courier"
                    tap="{{ onAddCourier }}"
                    class="bg-green-500 text-white p-3 rounded-lg m-1" />
            <Button col="1"
                    text="{{ isActive ? 'Deactivate' : 'Activate' }}"
                    tap="{{ onToggleStatus }}"
                    class="{{ isActive ? 'bg-red-500' : 'bg-green-500' }} text-white p-3 rounded-lg m-1" />
        </GridLayout>

        <!-- Assigned Couriers List -->
        <ScrollView row="2">
            <StackLayout class="p-2">
                <Label text="Assigned Couriers ({{ assignedCouriers.length }})"
                       class="font-bold text-lg m-2" />

                <!-- Loading -->
                <ActivityIndicator busy="{{ isLoading }}"
                                   visibility="{{ isLoading ? 'visible' : 'collapsed' }}"
                                   class="m-4" />

                <!-- Empty State -->
                <StackLayout visibility="{{ assignedCouriers.length === 0 && !isLoading ? 'visible' : 'collapsed' }}"
                             class="text-center p-8">
                    <Label text="No couriers assigned" class="text-gray-500 text-lg" />
                    <Label text="Tap '+ Add Courier' to assign couriers to this city"
                           class="text-gray-400 text-sm mt-2" textWrap="true" />
                </StackLayout>

                <!-- Couriers List -->
                <StackLayout>
                    <Repeater items="{{ assignedCouriers }}">
                        <Repeater.itemTemplate>
                            <GridLayout columns="auto, *, auto"
                                        rows="auto, auto"
                                        class="bg-white m-2 p-3 rounded-lg shadow">
                                <!-- Avatar -->
                                <StackLayout col="0" rowSpan="2"
                                             class="bg-purple-100 rounded-full w-12 h-12 m-2"
                                             verticalAlignment="center">
                                    <Label text="{{ courierName.charAt(0).toUpperCase() }}"
                                           class="text-purple-600 text-xl font-bold text-center"
                                           verticalAlignment="center" />
                                </StackLayout>

                                <!-- Info -->
                                <Label col="1" row="0"
                                       text="{{ courierName }}"
                                       class="font-bold text-lg" />
                                <Label col="1" row="1"
                                       text="{{ courierPhone }}"
                                       class="text-gray-500" />

                                <!-- Remove Button -->
                                <Button col="2" row="0" rowSpan="2"
                                        text="Remove"
                                        tap="{{ onRemoveCourier }}"
                                        class="bg-red-500 text-white p-2 rounded text-sm" />
                            </GridLayout>
                        </Repeater.itemTemplate>
                    </Repeater>
                </StackLayout>

                <!-- Available Couriers Section -->
                <Label text="Available Couriers ({{ availableCouriers.length }})"
                       class="font-bold text-lg m-2 mt-4"
                       visibility="{{ availableCouriers.length > 0 ? 'visible' : 'collapsed' }}" />

                <StackLayout visibility="{{ availableCouriers.length > 0 ? 'visible' : 'collapsed' }}">
                    <Repeater items="{{ availableCouriers }}">
                        <Repeater.itemTemplate>
                            <GridLayout columns="auto, *, auto"
                                        rows="auto, auto"
                                        class="bg-gray-50 m-2 p-3 rounded-lg border border-gray-200">
                                <!-- Avatar -->
                                <StackLayout col="0" rowSpan="2"
                                             class="bg-gray-200 rounded-full w-12 h-12 m-2"
                                             verticalAlignment="center">
                                    <Label text="{{ name.charAt(0).toUpperCase() }}"
                                           class="text-gray-600 text-xl font-bold text-center"
                                           verticalAlignment="center" />
                                </StackLayout>

                                <!-- Info -->
                                <Label col="1" row="0"
                                       text="{{ name }}"
                                       class="font-bold text-lg" />
                                <Label col="1" row="1"
                                       text="{{ phoneNumber }}"
                                       class="text-gray-500" />

                                <!-- Assign Button -->
                                <Button col="2" row="0" rowSpan="2"
                                        text="Assign"
                                        tap="{{ onAssignCourier }}"
                                        class="bg-green-500 text-white p-2 rounded text-sm" />
                            </GridLayout>
                        </Repeater.itemTemplate>
                    </Repeater>
                </StackLayout>
            </StackLayout>
        </ScrollView>
    </GridLayout>
</Page>
